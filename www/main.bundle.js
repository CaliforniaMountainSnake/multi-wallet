!function(){"use strict";var e,t,n,o,s,r={16:function(e,t,n){var o=n(294),s=n(745);class r extends o.Component{constructor(){super(...arguments),this.state={}}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){console.error("Unhandled top-level error:",e,t)}render(){return this.state.error?o.createElement(o.Fragment,null,o.createElement("h1",null,"Oops, something went wrong..."),o.createElement("figure",null,o.createElement("figcaption",null,this.state.error.name),o.createElement("p",null,this.state.error.message))):o.createElement(o.StrictMode,null,this.props.children)}}var a=function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))},i=function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))};class c extends class{open(e){return a(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const o=indexedDB.open(this.dbName,this.dbVersion);o.onupgradeneeded=t=>{this.migrateIndexedDB(t,o.result,o.transaction).catch((t=>e(t)))},o.onblocked=e=>this.onBlocked(e),o.onerror=()=>n(o.error),o.onsuccess=()=>{this.db=o.result,t(),console.debug(`IndexedDB "${this.dbName}" has been opened.`)}}))}))}deleteIndexedDB(){return a(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{this.db.close();const n=indexedDB.deleteDatabase(this.dbName);n.onblocked=e=>this.onBlocked(e),n.onerror=()=>t(n.error),n.onsuccess=()=>e()}))}))}deleteByKey(e,t){return a(this,void 0,void 0,(function*(){return yield this.transaction((n=>a(this,void 0,void 0,(function*(){const o=n.objectStore(e);return yield this.promiseRequest(o.delete(t))}))))}))}getByKey(e,t){return a(this,void 0,void 0,(function*(){return yield this.transaction((n=>a(this,void 0,void 0,(function*(){const o=n.objectStore(e);return yield this.promiseRequest(o.get(t))}))),"readonly")}))}getByKeyOfThrowError(e,t){return a(this,void 0,void 0,(function*(){const n=yield this.getByKey(e,t);if(n)return n;throw new Error(`Unable to find a row with key: "${t}" in the store "${e}"`)}))}promiseRequest(e){return a(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result)}))}))}promiseCursorRequest(e){return a(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const o=new Map;e.onerror=()=>n(e.error),e.onsuccess=()=>{const n=e.result;n?(o.set(n.key,n.value),n.continue()):t(o)}}))}))}transaction(e,t="readwrite"){return a(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{const s=this.db.transaction(this.db.objectStoreNames,t),r=e(s);s.onabort=e=>o(e.target.error),s.oncomplete=()=>{r.then((e=>n(e))).catch((e=>o(e)))}}))}))}onBlocked(e){const t="Unable to update the DB version (or delete the DB)! There is an another connection to the same DB. Please, close another tabs before update.";console.warn(t,e),alert(t)}migrateIndexedDB(e,t,n){return a(this,void 0,void 0,(function*(){if(console.warn(`IndexedDB upgrade needed! [${e.oldVersion} to ${e.newVersion}]`),!e.newVersion)return void console.debug("Database is being deleted...");const o=this.getMigrations();for(let s=e.oldVersion+1;s<=e.newVersion;s++){const r=o.get(s);if(!r)throw new Error(`Migration "${s}" does not exist!`);e.target,yield r(t,n),console.debug(`Migration "${s}" has been applied.`)}console.debug("All migrations have been applied.")}))}}{constructor(){super(...arguments),this.storeNames={configs:"configs",exchangeRates:"exchange_rates",userRates:"user_exchange_rates",amounts:"amounts"}}get dbName(){return"multi-wallet-app"}get dbVersion(){return 5}getMigrations(){const e=new Map;return e.set(1,(e=>i(this,void 0,void 0,(function*(){e.createObjectStore(this.storeNames.configs,{keyPath:"key"})})))),e.set(2,(e=>i(this,void 0,void 0,(function*(){e.createObjectStore(this.storeNames.exchangeRates,{keyPath:"symbol"})})))),e.set(3,(e=>i(this,void 0,void 0,(function*(){e.createObjectStore(this.storeNames.amounts,{autoIncrement:!0})})))),e.set(4,(e=>i(this,void 0,void 0,(function*(){e.createObjectStore(this.storeNames.userRates,{autoIncrement:!0})})))),e.set(5,((e,t)=>i(this,void 0,void 0,(function*(){const e=t.objectStore(this.storeNames.amounts),n=yield this.promiseCursorRequest(e.openCursor());for(const[t,o]of n)o.enabled=!0,e.put(o,t)})))),e}getConfig(e){return i(this,void 0,void 0,(function*(){const t=yield this.getByKey(this.storeNames.configs,e);return null==t?void 0:t.value}))}setConfig(e){return i(this,void 0,void 0,(function*(){return yield this.transaction((t=>i(this,void 0,void 0,(function*(){const n=t.objectStore(this.storeNames.configs);yield this.promiseRequest(n.put(e))}))))}))}getAmounts(){return i(this,void 0,void 0,(function*(){return yield this.transaction((e=>i(this,void 0,void 0,(function*(){const t=e.objectStore(this.storeNames.amounts);return yield this.promiseCursorRequest(t.openCursor())}))),"readonly")}))}getAmount(e){return i(this,void 0,void 0,(function*(){return yield this.getByKeyOfThrowError(this.storeNames.amounts,e)}))}putAmount(e,t){return i(this,void 0,void 0,(function*(){return yield this.transaction((n=>i(this,void 0,void 0,(function*(){const o=n.objectStore(this.storeNames.amounts);return yield this.promiseRequest(o.put(e,t))}))))}))}deleteAmount(e){return i(this,void 0,void 0,(function*(){return yield this.deleteByKey(this.storeNames.amounts,e)}))}getUserRates(){return i(this,void 0,void 0,(function*(){return yield this.transaction((e=>i(this,void 0,void 0,(function*(){const t=e.objectStore(this.storeNames.userRates);return yield this.promiseCursorRequest(t.openCursor())}))),"readonly")}))}addUserRate(e){return i(this,void 0,void 0,(function*(){return yield this.transaction((t=>i(this,void 0,void 0,(function*(){const n=t.objectStore(this.storeNames.userRates);return yield this.promiseRequest(n.add(e))}))))}))}deleteUserRate(e){return i(this,void 0,void 0,(function*(){return yield this.deleteByKey(this.storeNames.userRates,e)}))}getExchangeRates(){return i(this,void 0,void 0,(function*(){return yield this.transaction((e=>i(this,void 0,void 0,(function*(){const t=e.objectStore(this.storeNames.exchangeRates);return yield this.promiseCursorRequest(t.openCursor())}))),"readonly")}))}updateExchangeRates(e){return i(this,void 0,void 0,(function*(){return yield this.transaction((t=>i(this,void 0,void 0,(function*(){const n=t.objectStore(this.storeNames.exchangeRates),o=t.objectStore(this.storeNames.configs);for(const[t,o]of e.entries()){const e={symbol:t,name:o.name,unit:o.unit,value:o.value,type:o.type};n.put(e)}const s={key:"last_update_timestamp",value:Date.now()};yield this.promiseRequest(o.put(s))}))))}))}}var l=n(945);class h extends o.Component{constructor(){super(...arguments),this.state={loading:!1},this._handleClick=()=>{this.setState({loading:!0},(()=>{this.props.onClick(this.props.payload).catch((e=>{this.setState((()=>{throw e}))})).finally((()=>{this.setState({loading:!1})}))}))}}render(){return o.createElement(l.Z,{variant:this.props.variant,size:this.props.size,className:this.props.className,disabled:this.state.loading,onClick:this._handleClick},this.props.children)}}function u(e,...t){!function(e=console.log,t,...n){e(t,...n),alert(t+" "+n.join(" "))}(console.error,e,...t)}function d(e){if(0===e)return e.toString();if(e<1){const t=-Math.floor(Math.log10(e)+1);return e.toFixed(t+4)}return e.toFixed(2)}function m(e,t,n){return 0===t.amount?0:t.amount/p(e,n,t.symbol)}function p(e,t,n){const o=e.get(t),s=e.get(n);if(void 0===o||void 0===s)throw new Error(`Wrong currency symbols: "${t}" or "${n}"!`);return s.value/o.value}class v extends o.Component{constructor(){super(...arguments),this.handleClick=()=>{return e=this,t=void 0,o=function*(){try{yield this.props.loadFreshExchangeRates(this.props.dbRepository),this.props.onChange()}catch(e){u(e)}},new((n=void 0)||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}}render(){return o.createElement("div",{className:"card mb-3"},o.createElement("div",{className:"row card-body"},o.createElement("div",{className:"col-12 col-md-8 mb-1 mb-md-0"},o.createElement("h5",{className:"card-title"},"Date of the last exchange rates update:"),o.createElement("h6",{className:"card-subtitle text-muted"},new Date(this.props.ratesLastUpdateTimestamp).toLocaleString())),o.createElement("div",{className:"col-12 col-md-4 d-flex justify-content-md-end"},o.createElement(h,{variant:"primary",onClick:this.handleClick},"ðŸ—˜ Update exchange rates"))))}}var y=function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))};const f={amount:e=>y(void 0,void 0,void 0,(function*(){const t=parseFloat(e);if(Number.isNaN(t)||0===t)throw new Error("Please, enter a valid number!");return t})),symbol:b,symbols:(e,t,n)=>y(void 0,void 0,void 0,(function*(){if(yield b(e,n),yield b(t,n),e===t)throw new Error("Please, select different currencies!");return{symbol1:e,symbol2:t}})),comment:e=>y(void 0,void 0,void 0,(function*(){const t=e.trim();return""===t?void 0:t}))};function b(e,t){return y(this,void 0,void 0,(function*(){if(!t.get(e))throw new Error(`Wrong currency symbol: "${e}"!`);return e}))}class g extends o.Component{constructor(){super(...arguments),this.defaultState={amountFormData:void 0,amountFormError:void 0},this.state=this.defaultState,this.handleFormSubmit=e=>{if(e.preventDefault(),!this.state.amountFormData)throw new Error("Amount is invalid");f.amount(this.state.amountFormData).then((e=>{const t=Object.assign({},this.props.amount);return t.amount=e,this.props.dbRepository.putAmount(t,this.props.amountId)})).then((()=>{this.setState(this.defaultState),this.props.onChange(),console.debug("Amount has been updated.")})).catch((e=>{this.setState({amountFormError:e})}))},this.handleFormChange=e=>{this.setState({amountFormData:e.target.value})},this.showForm=()=>{this.setState({amountFormData:this.props.amount.amount.toString()})},this.showQuantity=()=>{this.setState(this.defaultState)}}render(){var e;return void 0!==this.state.amountFormData?o.createElement("td",null,o.createElement("form",{onSubmit:this.handleFormSubmit},o.createElement("div",null,o.createElement("input",{type:"number",className:"form-control mb-2 "+(this.state.amountFormError?"is-invalid":""),placeholder:"Enter amount",value:this.state.amountFormData,onChange:this.handleFormChange}),o.createElement("div",{className:"invalid-feedback"},null===(e=this.state.amountFormError)||void 0===e?void 0:e.message)),o.createElement("button",{type:"button",className:"btn btn-sm btn-secondary mb-2 me-2",onClick:this.showQuantity},"Cancel"),o.createElement(l.Z,{type:"submit",className:"btn btn-sm btn-warning mb-2"},"Update"))):o.createElement("td",{className:"text-nowrap",title:this.props.amountCurrencyInfo.name,onClick:this.showForm},`${this.props.amount.amount} ${this.props.amountCurrencyInfo.unit}`)}}class E extends o.Component{constructor(){super(...arguments),this.deleteAmount=()=>{return e=this,t=void 0,o=function*(){confirm(this.getAmountDeletionMsg(this.props.amount))&&(yield this.props.dbRepository.deleteAmount(this.props.amountId),console.debug(`Amount with key "${this.props.amountId}" has been deleted.`,this.props.amount),this.props.onChange())},new((n=void 0)||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o},this.switchAmountStatus=e=>{const t=Object.assign({},this.props.amount);t.enabled=!t.enabled,this.props.dbRepository.putAmount(t,this.props.amountId).then(this.props.onChange).catch((e=>{this.setState((()=>{throw e}))}))}}getAmountDeletionMsg(e){const t=this.props.exchangeRates.get(e.symbol).unit;let n=`Are you sure you want to delete ${e.amount} ${t} `;return n+=void 0===e.comment?"?":`(${e.comment}) ?`,n}render(){var e;const t=this.props.exchangeRates.get(this.props.amount.symbol),n=this.props.exchangeRates.get(this.props.selectedCurrencySymbol),s=m(this.props.exchangeRates,this.props.amount,n.symbol);return o.createElement("tr",{className:this.props.amount.enabled?void 0:"disabled"},o.createElement(g,{dbRepository:this.props.dbRepository,amountId:this.props.amountId,amount:this.props.amount,amountCurrencyInfo:t,onChange:this.props.onChange}),o.createElement("td",{className:"text-nowrap"},d(s)," ",n.unit),o.createElement("td",{style:{whiteSpace:"pre-line"}},null!==(e=this.props.amount.comment)&&void 0!==e?e:""),o.createElement("td",{className:"text-center w-auto"},o.createElement("div",{className:"form-switch"},o.createElement("input",{type:"checkbox",role:"switch",className:"form-check-input",checked:this.props.amount.enabled,onChange:this.switchAmountStatus}))),o.createElement("td",{className:"text-center w-auto"},o.createElement(h,{variant:"secondary",size:"sm",onClick:this.deleteAmount},"Delete")))}}var w=n(319);class C extends o.Component{render(){const e=[];for(const[,t]of this.props.exchangeRates.entries())e.push(o.createElement("option",{key:t.symbol,value:t.symbol},`${t.symbol} - ${t.name}`));return o.createElement(w.Z.Control,{as:"select",className:this.props.className,isInvalid:this.props.isInvalid,disabled:0===this.props.exchangeRates.size,value:this.props.value,onChange:this.props.onChange},e)}}class x extends o.Component{constructor(){super(...arguments),this.updateSelectedCurrency=e=>{this.props.dbRepository.setConfig({key:"selected_currency",value:e.target.value}).then((()=>{this.props.onSelectedCurrencyChange()})).catch((e=>{this.setState((()=>{throw e}))}))}}calculateTotalSum(){const e=this.props.exchangeRates.get(this.props.selectedCurrencySymbol);let t=0;for(const n of this.props.amounts.values())n.enabled&&(t+=m(this.props.exchangeRates,n,e.symbol));return t}render(){const e=this.props.exchangeRates.get(this.props.selectedCurrencySymbol);return o.createElement("tr",null,o.createElement("th",null,"Total:"),o.createElement("td",{className:"text-nowrap"},d(this.calculateTotalSum())," ",e.unit),o.createElement("td",{colSpan:3},o.createElement(C,{className:"form-select",exchangeRates:this.props.exchangeRates,value:e.symbol,onChange:this.updateSelectedCurrency})))}}var R=n(454),S=function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))};class k extends o.Component{constructor(){super(...arguments),this.idPrefix=`${this.constructor.name}_`,this.ids={amount:`${this.idPrefix}amount`,symbol:`${this.idPrefix}symbol`,comment:`${this.idPrefix}comment`},this.initialState={isModalShown:!1,amount:"",symbol:this.props.exchangeRates.keys().next().value,comment:"",amountError:void 0,symbolError:void 0},this.state=this.initialState,this.handleFormSubmit=e=>{e.preventDefault(),this.addAmount().catch((e=>{if(e instanceof Error)return console.error("Unexpected error:",e),void this.setState((()=>{throw e}));this.setState(e)}))},this.handleFormChange=e=>{const t=e.target.value;switch(e.target.id){case this.ids.amount:this.setState({amount:t,amountError:void 0});break;case this.ids.symbol:this.setState({symbol:t,symbolError:void 0});break;case this.ids.comment:this.setState({comment:t})}},this.hideModal=()=>{this.setState({isModalShown:!1})},this.showModal=()=>{this.setState({isModalShown:!0})}}validate(){return S(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n={enabled:!0},o={};Promise.allSettled([f.amount(this.state.amount),f.symbol(this.state.symbol,this.props.exchangeRates),f.comment(this.state.comment)]).then((([s,r,a])=>{"fulfilled"===s.status?n.amount=s.value:o.amountError=s.reason,"fulfilled"===r.status?n.symbol=r.value:o.amountError=r.reason,"fulfilled"===a.status?n.comment=a.value:o.amountError=a.reason,o.amountError||o.symbolError?t(o):e(n)}))}))}))}addAmount(){return S(this,void 0,void 0,(function*(){const e=yield this.validate(),t=yield this.props.dbRepository.putAmount(e);this.setState(this.initialState),this.props.onChange(),console.debug("Added amount with key:",t)}))}render(){var e,t;return o.createElement(o.Fragment,null,o.createElement(R.Z,{show:this.state.isModalShown,backdrop:"static",keyboard:!1,centered:!0,onHide:this.hideModal},o.createElement(R.Z.Header,{closeButton:!0},o.createElement(R.Z.Title,null,"Add new amount")),o.createElement(R.Z.Body,null,o.createElement(w.Z,{onSubmit:this.handleFormSubmit},o.createElement(w.Z.Group,{className:"mb-3",controlId:this.ids.amount},o.createElement(w.Z.Label,null,"Amount:"),o.createElement(w.Z.Control,{type:"number",placeholder:"Enter amount",isInvalid:void 0!==this.state.amountError,value:this.state.amount,onChange:this.handleFormChange}),o.createElement(w.Z.Control.Feedback,{type:"invalid"},null===(e=this.state.amountError)||void 0===e?void 0:e.message)),o.createElement(w.Z.Group,{className:"mb-3",controlId:this.ids.symbol},o.createElement(w.Z.Label,null,"Currency:"),o.createElement(C,{isInvalid:void 0!==this.state.symbolError,exchangeRates:this.props.exchangeRates,value:this.state.symbol,onChange:this.handleFormChange}),o.createElement(w.Z.Control.Feedback,{type:"invalid"},null===(t=this.state.symbolError)||void 0===t?void 0:t.message)),o.createElement(w.Z.Group,{className:"mb-3",controlId:this.ids.comment},o.createElement(w.Z.Label,null,"Comment:"),o.createElement(w.Z.Control,{type:"text",as:"textarea",value:this.state.comment,onChange:this.handleFormChange})),o.createElement(l.Z,{type:"button",variant:"secondary",className:"me-2",onClick:this.hideModal},"Cancel"),o.createElement(l.Z,{type:"submit",variant:"primary",disabled:0===this.props.exchangeRates.size},"Add")))),o.createElement(l.Z,{variant:"primary",className:this.props.className,onClick:this.showModal},"Add amount"))}}class N extends o.Component{render(){const e=this.props.exchangeRates.get(this.props.selectedCurrencySymbol),t=[];for(const[e,n]of this.props.amounts.entries())t.push(o.createElement(E,{key:e,dbRepository:this.props.dbRepository,amountId:e,amount:n,exchangeRates:this.props.exchangeRates,selectedCurrencySymbol:this.props.selectedCurrencySymbol,onChange:this.props.onAmountsChange}));return o.createElement("div",null,o.createElement("h2",null,"Your wallet"),o.createElement(k,{className:"mb-2",dbRepository:this.props.dbRepository,exchangeRates:this.props.exchangeRates,onChange:this.props.onAmountsChange}),o.createElement("div",{className:"table-responsive"},o.createElement("table",{className:"table table-bordered align-middle"},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,"Amount"),o.createElement("th",{className:"text-nowrap"},"Amount in ",e.unit),o.createElement("th",null,"Comment"),o.createElement("th",{colSpan:2},"Actions"))),o.createElement("tfoot",null,o.createElement(x,{dbRepository:this.props.dbRepository,amounts:this.props.amounts,exchangeRates:this.props.exchangeRates,selectedCurrencySymbol:this.props.selectedCurrencySymbol,onSelectedCurrencyChange:this.props.onSelectedCurrencyChange})),o.createElement("tbody",null,t))))}}var D=function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))};class M{constructor(){this.apiDomain="https://api.coingecko.com/api/v3"}getSupportedVsCurrencies(){return D(this,void 0,void 0,(function*(){return yield this.request("/simple/supported_vs_currencies")}))}getExchangeRates(){return D(this,void 0,void 0,(function*(){const e=(yield this.request("/exchange_rates")).rates;return new Map(Object.entries(e))}))}request(e){return D(this,void 0,void 0,(function*(){const t=yield fetch(this.apiDomain+e,{headers:{Accept:"application/json"}});if(200!==t.status)throw new Error(`Wrong API response code (${t.status})`);return yield t.json()}))}}class A extends o.Component{constructor(){super(...arguments),this.idPrefix=`${this.constructor.name}_`,this.ids={symbol1:`${this.idPrefix}symbol1`,symbol2:`${this.idPrefix}symbol2`},this.initialState={isModalShown:!1,symbol1:this.props.exchangeRates.keys().next().value,symbol2:this.props.exchangeRates.keys().next().value,validationError:void 0},this.state=this.initialState,this.handleFormSubmit=e=>{e.preventDefault(),this.addNewRate().catch((e=>{this.setState({validationError:e})}))},this.addNewRate=()=>{return e=this,t=void 0,o=function*(){const e=yield f.symbols(this.state.symbol1,this.state.symbol2,this.props.exchangeRates),t=yield this.props.dbRepository.addUserRate(e);this.setState(this.initialState),this.props.onChange(),console.debug("New user exchange rate added",t)},new((n=void 0)||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o},this.handleFormChange=e=>{const t=e.target.value;switch(e.target.id){case this.ids.symbol1:this.setState({symbol1:t,validationError:void 0});break;case this.ids.symbol2:this.setState({symbol2:t,validationError:void 0})}},this.hideModal=()=>{this.setState({isModalShown:!1})},this.showModal=()=>{this.setState({isModalShown:!0})}}render(){var e,t;return o.createElement(o.Fragment,null,o.createElement(R.Z,{show:this.state.isModalShown,backdrop:"static",keyboard:!1,centered:!0,onHide:this.hideModal},o.createElement(R.Z.Header,{closeButton:!0},o.createElement(R.Z.Title,null,"Add favorite exchange rate")),o.createElement(R.Z.Body,null,o.createElement(w.Z,{onSubmit:this.handleFormSubmit},o.createElement(w.Z.Group,{className:"mb-3",controlId:this.ids.symbol1},o.createElement(w.Z.Label,null,"First currency:"),o.createElement(C,{isInvalid:void 0!==this.state.validationError,exchangeRates:this.props.exchangeRates,value:this.state.symbol1,onChange:this.handleFormChange}),o.createElement(w.Z.Control.Feedback,{type:"invalid"},null===(e=this.state.validationError)||void 0===e?void 0:e.message)),o.createElement(w.Z.Group,{className:"mb-3",controlId:this.ids.symbol2},o.createElement(w.Z.Label,null,"Second currency:"),o.createElement(C,{isInvalid:void 0!==this.state.validationError,exchangeRates:this.props.exchangeRates,value:this.state.symbol2,onChange:this.handleFormChange}),o.createElement(w.Z.Control.Feedback,{type:"invalid"},null===(t=this.state.validationError)||void 0===t?void 0:t.message)),o.createElement(l.Z,{type:"button",variant:"secondary",className:"me-2",onClick:this.hideModal},"Cancel"),o.createElement(l.Z,{type:"submit",variant:"primary"},"Add")))),o.createElement(l.Z,{variant:"primary",className:this.props.className,onClick:this.showModal},"Add rate"))}}class F extends o.Component{constructor(){super(...arguments),this.state={userRates:void 0},this.onUserRatesChanged=()=>{this.props.dbRepository.getUserRates().then((e=>{this.setState({userRates:e})})).catch((e=>{u("Unable to update favorite exchange rates!",e)}))},this.deleteUserRate=e=>{return t=this,n=void 0,s=function*(){var t;const n=null===(t=this.state.userRates)||void 0===t?void 0:t.get(e);confirm(`Are you sure you want to delete "${n.symbol1}/${n.symbol2}" pair?`)&&this.props.dbRepository.deleteUserRate(e).then((()=>{this.onUserRatesChanged(),console.debug(`Favorite exchange rates pair with key "${e}" has been deleted.`)})).catch((e=>{u("Unable to delete favorite rates pair!",e)}))},new((o=void 0)||(o=Promise))((function(e,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function i(e){try{c(s.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(a,i)}c((s=s.apply(t,n||[])).next())}));var t,n,o,s}}componentDidMount(){this.state.userRates||this.onUserRatesChanged()}render(){const e=[];if(this.state.userRates)for(const[t,n]of this.state.userRates){const s=this.props.exchangeRates.get(n.symbol1),r=this.props.exchangeRates.get(n.symbol2);e.push(o.createElement("tr",{key:t},o.createElement("td",{className:"text-nowrap",title:`${s.name} / ${r.name}`},n.symbol1,"/",n.symbol2),o.createElement("td",{className:"text-nowrap"},d(p(this.props.exchangeRates,n.symbol1,n.symbol2))," ",r.unit),o.createElement("td",{className:"text-center"},o.createElement(h,{payload:t,variant:"secondary",size:"sm",onClick:this.deleteUserRate},"Delete"))))}return o.createElement("div",null,o.createElement("h2",{className:"card-title"},"Exchange rates"),o.createElement(A,{className:"mb-2",dbRepository:this.props.dbRepository,exchangeRates:this.props.exchangeRates,onChange:this.onUserRatesChanged}),o.createElement("div",{className:"table-responsive"},o.createElement("table",{className:"table table-bordered align-middle"},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,"Pair"),o.createElement("th",null,"Cost"),o.createElement("th",null,"Actions"))),o.createElement("tbody",null,e))))}}class P extends o.Component{constructor(){super(...arguments),this.darkModeQuery="(prefers-color-scheme: dark)",this.state={isDarkMode:window.matchMedia(this.darkModeQuery).matches},this.darkModeListener=e=>{this.setState({isDarkMode:e.matches})}}componentDidMount(){window.matchMedia(this.darkModeQuery).addEventListener("change",this.darkModeListener),console.log("Listener was added.")}componentWillUnmount(){window.matchMedia(this.darkModeQuery).removeEventListener("change",this.darkModeListener),console.log("Listener was removed.")}loadTheme(e){switch(e){case"default_bootstrap":return o.createElement((0,o.lazy)((()=>Promise.all([n.e(388),n.e(147)]).then(n.bind(n,147)))));case"journal":return o.createElement((0,o.lazy)((()=>Promise.all([n.e(345),n.e(892)]).then(n.bind(n,892)))));case"material":return o.createElement((0,o.lazy)((()=>Promise.all([n.e(843),n.e(959)]).then(n.bind(n,959)))));case"slate":return o.createElement((0,o.lazy)((()=>Promise.all([n.e(142),n.e(602)]).then(n.bind(n,602)))));case"solar":return o.createElement((0,o.lazy)((()=>Promise.all([n.e(63),n.e(106)]).then(n.bind(n,106)))));default:throw Error(`Invalid theme name: "${this.props.lightTheme}"`)}}render(){return o.createElement(o.Suspense,{fallback:this.props.fallback},this.loadTheme(this.state.isDarkMode?this.props.darkTheme:this.props.lightTheme),this.props.children)}}var $=function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function a(e){try{c(o.next(e))}catch(e){r(e)}}function i(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))};class Z extends o.Component{constructor(){super(...arguments),this.defaultCurrency="usd",this.coingeckoRepository=new M,this.state={theme:"material",amounts:new Map,exchangeRates:new Map},this.deleteDb=()=>$(this,void 0,void 0,(function*(){const e=this.state.dbRepository;confirm("Are you sure you want to delete the local DB?")&&(yield e.deleteIndexedDB(),console.warn(`Database "${e.dbName}" has been deleted.`),yield this.initialize())})),this.onDbDataChanged=()=>{this.loadDbData(this.state.dbRepository).then((e=>{this.setState(e,(()=>console.log("DB data were changed.")))})).catch((e=>{this.setState((()=>{throw e}))}))},this.loadFreshExchangeRates=e=>$(this,void 0,void 0,(function*(){try{const t=yield this.coingeckoRepository.getExchangeRates();yield e.updateExchangeRates(t),console.debug("Fresh exchange rates were loaded from coingecko and saved into the DB.")}catch(e){throw new Error(`Unable to load fresh exchange rates: ${e}`)}})),this.changeTheme=()=>{this.setState({theme:"slate"})}}loadDbData(e){return $(this,void 0,void 0,(function*(){const[t,n,o,s]=yield Promise.all([e.getAmounts(),e.getExchangeRates(),e.getConfig("last_update_timestamp"),e.getConfig("selected_currency")]);return{theme:"material",dbRepository:e,amounts:t,exchangeRates:n,ratesLastUpdateTimestamp:o,selectedCurrencySymbol:s}}))}initialize(){return $(this,void 0,void 0,(function*(){const e=new c;yield e.open((e=>$(this,void 0,void 0,(function*(){this.setState((()=>{throw e}))}))));const t=yield this.loadDbData(e);0===t.exchangeRates.size&&(yield this.loadFreshExchangeRates(e)),t.selectedCurrencySymbol||(yield e.setConfig({key:"selected_currency",value:this.defaultCurrency})),this.setState(yield this.loadDbData(e),(()=>{console.info("App data were initialized.")}))}))}componentDidMount(){console.debug(`Component "${this.constructor.name}" was mounted.`),document.title="Multi-currency Wallet",this.state.dbRepository||this.initialize().catch((e=>{this.setState((()=>{throw e}))}))}render(){return this.state.dbRepository&&this.state.ratesLastUpdateTimestamp&&this.state.selectedCurrencySymbol?o.createElement(P,{lightTheme:"material",darkTheme:"slate",fallback:o.createElement(B,null)},o.createElement("div",{className:"container-lg mt-2 mb-2"},o.createElement("h1",null,"Multi-currency Wallet"),o.createElement(v,{dbRepository:this.state.dbRepository,ratesLastUpdateTimestamp:this.state.ratesLastUpdateTimestamp,loadFreshExchangeRates:this.loadFreshExchangeRates,onChange:this.onDbDataChanged}),o.createElement("div",{className:"row"},o.createElement("div",{className:"col-12 col-lg-4"},o.createElement(F,{dbRepository:this.state.dbRepository,exchangeRates:this.state.exchangeRates})),o.createElement("div",{className:"col-12 col-lg-8"},o.createElement(N,{dbRepository:this.state.dbRepository,amounts:this.state.amounts,exchangeRates:this.state.exchangeRates,selectedCurrencySymbol:this.state.selectedCurrencySymbol,onAmountsChange:this.onDbDataChanged,onSelectedCurrencyChange:this.onDbDataChanged}))),o.createElement(h,{variant:"danger",onClick:this.deleteDb},"âš  Clear DB"),o.createElement(l.Z,{variant:"info",onClick:this.changeTheme},"Change theme"))):o.createElement(j,null)}}class j extends o.Component{render(){return o.createElement("div",null,"Database loading...")}}class B extends o.Component{render(){return o.createElement("div",null,"Theme loading...")}}const T=document.createElement("main");document.body.append(T),(0,s.s)(T).render(o.createElement(r,null,o.createElement(Z,null)))}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return r[e](n,n.exports,i),n.exports}i.m=r,e=[],i.O=function(t,n,o,s){if(!n){var r=1/0;for(h=0;h<e.length;h++){n=e[h][0],o=e[h][1],s=e[h][2];for(var a=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(i.O).every((function(e){return i.O[e](n[c])}))?n.splice(c--,1):(a=!1,s<r&&(r=s));if(a){e.splice(h--,1);var l=o();void 0!==l&&(t=l)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[n,o,s]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,n){return i.f[n](e,t),t}),[]))},i.u=function(e){return e+".chunk-bundle.js"},i.miniCssF=function(e){return e+".css"},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t={},n="finance-app:",i.l=function(e,o,s,r){if(t[e])t[e].push(o);else{var a,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var u=l[h];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+s){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",n+s),a.src=e),t[e]=[o];var d=function(n,o){a.onerror=a.onload=null,clearTimeout(m);var s=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((function(e){return e(o)})),n)return n(o)},m=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e}(),o=function(e){return new Promise((function(t,n){var o=i.miniCssF(e),s=i.p+o;if(function(e,t){for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var s=(a=n[o]).getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(s===e||s===t))return a}var r=document.getElementsByTagName("style");for(o=0;o<r.length;o++){var a;if((s=(a=r[o]).getAttribute("data-href"))===e||s===t)return a}}(o,s))return t();!function(e,t,n,o){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.onerror=s.onload=function(r){if(s.onerror=s.onload=null,"load"===r.type)n();else{var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=i,s.parentNode.removeChild(s),o(c)}},s.href=t,document.head.appendChild(s)}(e,s,t,n)}))},s={179:0},i.f.miniCss=function(e,t){s[e]?t.push(s[e]):0!==s[e]&&{63:1,142:1,345:1,388:1,843:1}[e]&&t.push(s[e]=o(e).then((function(){s[e]=0}),(function(t){throw delete s[e],t})))},function(){var e={179:0};i.f.j=function(t,n){var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else if(/^(142|345|388|63|843)$/.test(t))e[t]=0;else{var s=new Promise((function(n,s){o=e[t]=[n,s]}));n.push(o[2]=s);var r=i.p+i.u(t),a=new Error;i.l(r,(function(n){if(i.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var s=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,o[1](a)}}),"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,s,r=n[0],a=n[1],c=n[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(o in a)i.o(a,o)&&(i.m[o]=a[o]);if(c)var h=c(i)}for(t&&t(n);l<r.length;l++)s=r[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(h)},n=self.webpackChunkfinance_app=self.webpackChunkfinance_app||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var c=i.O(void 0,[686],(function(){return i(16)}));c=i.O(c)}();
//# sourceMappingURL=main.bundle.js.map